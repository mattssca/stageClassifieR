% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/predict_stage.R
\name{predict_stage}
\alias{predict_stage}
\title{Predict Bladder Cancer Stage (MIBC vs NMIBC)}
\usage{
predict_stage(
  these_predictions = NULL,
  these_sample_ids = NULL,
  expression_data = NULL,
  this_threshold = 0.596
)
}
\arguments{
\item{these_predictions}{A prediction object from LundTaxR containing subtype
predictions, signature scores, and optionally expression data. This should be
the output from LundTaxR classification functions.}

\item{these_sample_ids}{Character vector of sample IDs to include in the prediction.
If NULL (default), all samples in the prediction object will be used.}

\item{expression_data}{Optional matrix or data frame of gene expression data with
genes as rows and samples as columns. If NULL (default), expression data will
be extracted from the these_predictions object.}

\item{this_threshold}{Numeric threshold for classification probability (default = 0.596).
Samples with probability >= threshold are classified as MIBC, others as NMIBC.}
}
\value{
A data frame with three columns:
\itemize{
\item sample_id: Character vector of sample identifiers
\item prediction: Character vector of stage predictions ("mibc" or "nmibc")
\item probability: Numeric vector of prediction probabilities for MIBC class
}
}
\description{
This function predicts bladder cancer stage classification as either muscle-invasive
bladder cancer (MIBC) or non-muscle-invasive bladder cancer (NMIBC) using a random
forest classifier trained on gene expression data and molecular signatures.
}
\details{
The function performs the following steps:
\enumerate{
\item Extracts molecular subtype classifications from LundTaxR predictions
\item Processes signature scores for progression risk and molecular grades
\item Combines expression data for top predictive genes with clinical features
\item Uses a pre-trained random forest classifier to predict stage
\item Returns predictions with associated probabilities
}

Missing features are imputed using mean values from the training data. The
classifier requires specific molecular subtypes and signature scores that are
generated by the LundTaxR classification system.
}
\examples{
\dontrun{
# Basic usage with LundTaxR predictions
stage_results <- predict_stage(lundtax_predictions)

# Predict for specific samples only
selected_samples <- c("sample1", "sample2", "sample3")
stage_results <- predict_stage(
  these_predictions = lundtax_predictions,
  these_sample_ids = selected_samples
)

# Use custom expression data and threshold
stage_results <- predict_stage(
  these_predictions = lundtax_predictions,
  expression_data = my_expression_matrix,
  this_threshold = 0.6
)

# View results
head(stage_results)
table(stage_results$prediction)
}

}
\seealso{
\code{\link[LundTaxR]{classify_samples}} for generating the required prediction object
}
